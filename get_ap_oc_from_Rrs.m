function [ap,apwl,oc] = get_ap_oc_from_Rrs(currRrs,currwvn)

% use OC4 to estimate Chl

% coefficients for OC4 equation
a = [0.3272,-2.9940,2.7218,-1.2259,-0.5683];

% wavelengths for OC4
wl_oc4 = [443,490,510,555,670]; %these are the wavelengths for OC4

[~,ind443] = min(abs(wl_oc4(1)-currwvn));
[~,ind490] = min(abs(wl_oc4(2)-currwvn));
[~,ind510] = min(abs(wl_oc4(3)-currwvn));
[~,ind555] = min(abs(wl_oc4(4)-currwvn));

Rrs_oc = [currRrs(ind443),currRrs(ind490),currRrs(ind510),currRrs(ind555)];

r = log10(max([Rrs_oc(1),Rrs_oc(2),Rrs_oc(3)]')' ./ Rrs_oc(4));

oc = 10.^(a(1) + a(2)*r + a(3)*r.^2 + a(4)*r.^3 + a(5)*r.^4);

% Using the chl from OC4, get the ap spectrum based on A and B
% coefficients from ap vs chl of all Tara data
Achi = [0.0637
    0.0642
    0.0651
    0.0656
    0.0662
    0.0666
    0.0669
    0.0674
    0.0677
    0.0681
    0.0683
    0.0685
    0.0687
    0.0688
    0.0688
    0.0686
    0.0682
    0.0676
    0.0669
    0.0661
    0.0654
    0.0646
    0.0639
    0.0632
    0.0625
    0.0619
    0.0613
    0.0606
    0.0600
    0.0593
    0.0585
    0.0576
    0.0568
    0.0558
    0.0549
    0.0539
    0.0529
    0.0519
    0.0508
    0.0498
    0.0487
    0.0475
    0.0463
    0.0451
    0.0438
    0.0425
    0.0411
    0.0398
    0.0384
    0.0371
    0.0358
    0.0346
    0.0334
    0.0323
    0.0312
    0.0301
    0.0291
    0.0281
    0.0272
    0.0262
    0.0253
    0.0245
    0.0236
    0.0228
    0.0219
    0.0212
    0.0204
    0.0196
    0.0189
    0.0182
    0.0175
    0.0168
    0.0161
    0.0155
    0.0149
    0.0143
    0.0137
    0.0132
    0.0127
    0.0122
    0.0117
    0.0113
    0.0110
    0.0108
    0.0106
    0.0104
    0.0103
    0.0101
    0.0100
    0.0099
    0.0098
    0.0097
    0.0095
    0.0094
    0.0092
    0.0091
    0.0089
    0.0088
    0.0087
    0.0086
    0.0085
    0.0085
    0.0085
    0.0085
    0.0085
    0.0085
    0.0086
    0.0086
    0.0086
    0.0087
    0.0087
    0.0088
    0.0088
    0.0088
    0.0088
    0.0089
    0.0089
    0.0089
    0.0090
    0.0090
    0.0092
    0.0095
    0.0099
    0.0106
    0.0113
    0.0124
    0.0136
    0.0150
    0.0164
    0.0179
    0.0193
    0.0206
    0.0214
    0.0220
    0.0221
    0.0218
    0.0209
    0.0196
    0.0179
    0.0160
    0.0139
    0.0118
    0.0097
    0.0078
    0.0061
    0.0047
    0.0035
    0.0026
    0.0019
    0.0013
    0.0009
    0.0006
    0.0004
    0.0002
    0.0002
    0.0001];

Bchi = [0.6966
    0.6934
    0.6929
    0.6898
    0.6872
    0.6847
    0.6834
    0.6825
    0.6811
    0.6800
    0.6802
    0.6806
    0.6800
    0.6799
    0.6794
    0.6792
    0.6788
    0.6787
    0.6785
    0.6784
    0.6784
    0.6787
    0.6796
    0.6807
    0.6821
    0.6836
    0.6850
    0.6867
    0.6882
    0.6894
    0.6908
    0.6917
    0.6926
    0.6928
    0.6928
    0.6927
    0.6924
    0.6920
    0.6921
    0.6922
    0.6927
    0.6935
    0.6949
    0.6968
    0.6994
    0.7027
    0.7065
    0.7109
    0.7154
    0.7203
    0.7254
    0.7302
    0.7350
    0.7400
    0.7446
    0.7489
    0.7530
    0.7574
    0.7615
    0.7652
    0.7685
    0.7715
    0.7739
    0.7760
    0.7777
    0.7792
    0.7803
    0.7806
    0.7805
    0.7801
    0.7797
    0.7790
    0.7783
    0.7772
    0.7761
    0.7748
    0.7734
    0.7717
    0.7702
    0.7683
    0.7647
    0.7611
    0.7597
    0.7580
    0.7568
    0.7558
    0.7555
    0.7547
    0.7545
    0.7546
    0.7542
    0.7537
    0.7530
    0.7526
    0.7516
    0.7510
    0.7502
    0.7500
    0.7502
    0.7514
    0.7531
    0.7545
    0.7562
    0.7579
    0.7601
    0.7622
    0.7645
    0.7661
    0.7679
    0.7690
    0.7699
    0.7703
    0.7705
    0.7699
    0.7684
    0.7667
    0.7644
    0.7617
    0.7597
    0.7581
    0.7582
    0.7586
    0.7624
    0.7669
    0.7709
    0.7772
    0.7813
    0.7867
    0.7902
    0.7922
    0.7949
    0.7976
    0.7987
    0.8011
    0.8014
    0.8043
    0.8041
    0.8062
    0.8067
    0.8088
    0.8119
    0.8130
    0.8149
    0.8163
    0.8184
    0.8231
    0.8307
    0.8348
    0.8391
    0.8379
    0.8296
    0.7986
    0.7209
    0.6202
    0.4277
    0.0673];

twonm = 406:2:716;

ap = Achi.*oc.^Bchi;
apwl = twonm;

end

